<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  

  <title> Installation of Quentier&#39;s dependencies  &middot; Quentier </title>

  
  <link rel="stylesheet" href="https://d1vanov.github.io/quentier/css/poole.css">
  <link rel="stylesheet" href="https://d1vanov.github.io/quentier/css/syntax.css">
  <link rel="stylesheet" href="https://d1vanov.github.io/quentier/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon" sizes="180x180" href="/quentier/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/quentier/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/quentier/favicon-16x16.png">
  <link rel="manifest" href="/quentier/manifest.json">
  <link rel="mask-icon" href="/quentier/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Quentier" />
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

  <link href='https://fonts.googleapis.com/css?family=Fira+Sans:400,300' rel='stylesheet' type='text/css'>

  <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
  <script>
    WebFont.load({
      google: {
        families: ['Fira Sans']
      }
    });
  </script>

</head>

<body class="theme-base-0d">

  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about" align=center>
      <h1 class="brand"><a href="https://d1vanov.github.io/quentier">Quentier</a></h1>
      <img src="/quentier/quentier_icon.svg" width=50% />
      <p class="lead">
         Free &amp; open source desktop Evernote client 
      </p>
    </div>
    <ul class="sidebar-nav">
      <li><a href="https://d1vanov.github.io/quentier/blog">Posts</a></li>
      <ul class="posts">
          
          <li><span><a href="https://d1vanov.github.io/quentier/blog/quentier-local-storage-overview/">Quentier local storage implementation overview</a></span></li>
          
          <li><span><a href="https://d1vanov.github.io/quentier/blog/quentier-installation-of-dependencies/">Installation of Quentier&#39;s dependencies</a></span></li>
          
          <li><span><a href="https://d1vanov.github.io/quentier/blog/quentier-technical-overview/">Quentier internals overview</a></span></li>
          
          <li><span><a href="https://d1vanov.github.io/quentier/blog/quentier-brief-overview/">Brief overview of Quentier features</a></span></li>
          
          <li><span><a href="https://d1vanov.github.io/quentier/blog/helloworld/">Hello world!</a></span></li>
          
      </ul>
      
      <br/> 
    </ul>
     
    
    
    <a href="https://github.com/d1vanov"><i class="fa fa-github-square"></i></a>&nbsp;&nbsp; 
    
    
      <a href="https://d1vanov.github.io/quentier/index.xml" type="application/rss+xml"><i class="fa fa-rss-square"></i></a>
    

    <p class="footnote">powered by <a href="http://gohugo.io">Hugo</a> <br/> &copy; 2019 Dmitry Ivanov. All rights reserved.</p>

  </div>
</div>


  <div class="content container">
    <div class="post">
    <h1 class="post-title">Installation of Quentier&#39;s dependencies</h1>
    <span class="post-date">Jan 19, 2018</span>
    
	    
    	<p class="seriesname">Series: <a href="https://d1vanov.github.io/quentier/series/developers-guide">Developers guide</a></p>
    
    

<p><strong>Updated 2019-05-03</strong></p>

<h3 id="table-of-contents">Table of contents</h3>

<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#linux">Linux</a></li>
<li><a href="#mac">Mac</a></li>
<li><a href="#windows">Windows</a>

<ul>
<li><a href="#building-dependencies-with-visual-studio">Building dependencies with Visual Studio</a>

<ul>
<li><a href="#preparing-the-environment">Preparing the environment</a></li>
<li><a href="#building-boost-program-options-library">Building boost program options library</a></li>
<li><a href="#building-openssl">Building OpenSSL</a></li>
<li><a href="#building-libiconv">Building libiconv</a></li>
<li><a href="#building-zlib">Building zlib</a></li>
<li><a href="#building-libxml2">Building libxml2</a></li>
<li><a href="#building-libhunspell">Building libhunspell</a></li>
<li><a href="#building-tidy-html5">Building tidy-html5</a></li>
<li><a href="#building-qtkeychain">Building qtkeychain</a></li>
<li><a href="#building-google-breakpad">Building Google breakpad</a></li>
</ul></li>
<li><a href="#building-dependencies-with-mingw">Building dependencies with MinGW</a>

<ul>
<li><a href="#building-boost-program-options-library-1">Building boost program options library</a></li>
<li><a href="#building-openssl-1">Building OpenSSL</a></li>
<li><a href="#building-libiconv-1">Building libiconv</a></li>
<li><a href="#building-zlib-1">Building zlib</a></li>
<li><a href="#building-libxml2-1">Building libxml2</a></li>
<li><a href="#building-libhunspell-1">Building libhunspell</a></li>
<li><a href="#building-tidy-html5-1">Building tidy-html5</a></li>
<li><a href="#building-qtkeychain-1">Building qtkeychain</a></li>
</ul></li>
</ul></li>
</ul>

<h3 id="introduction">Introduction</h3>

<p>Quentier has a fair share of dependencies and their installation is a complex enough procedure, especially on Windows platform. This post explains some details of the process.</p>

<h3 id="dependencies">Dependencies</h3>

<p>First let&rsquo;s just enumerate the dependencies:</p>

<p>Quentier itself depends on just a few Qt modules:</p>

<ul>
<li>For Qt4: QtCore, QtGui</li>
<li>For Qt5: Qt5Core, Qt5Gui, Qt5Widgets, Qt5LinguistTools</li>
</ul>

<p>Quentier also depends on the following libraries:</p>

<ul>
<li><a href="http://github.com/d1vanov/libquentier">libquentier</a></li>
<li><a href="https://github.com/d1vanov/QEverCloud">QEverCloud</a></li>
<li><a href="http://www.boost.org/doc/libs/release/libs/program_options">Boost program options</a> (&gt;= 1.38)</li>
<li>For Qt4 buidls only: <a href="https://github.com/d1vanov/qt4-mimetypes">qt4-mimetypes</a></li>
<li>Optional although recommended dependency on Linux and Windows (with MSVC only at the time): <a href="https://chromium.googlesource.com/breakpad/breakpad">Google breakpad</a></li>
</ul>

<p>Although it is theoretically possible to use different Qt versions to build Quentier and its dependencies, it is highly not recommended as it can cause all sort of building and/or runtime issues.</p>

<p>Libquentier&rsquo;s dependencies are as follows:</p>

<ul>
<li>For Qt4: QtCore, QtGui, QtNetwork, QtXml, QtSql, QtTest + QtDBus on Linux platform only + optionally (although required for using libquentier along with Quentier app) QtWebKit</li>
<li>For Qt5: Qt5Core, Qt5Gui, Qt5Widgets, Qt5Network, Qt5PrintSupport, Qt5Xml, Qt5Sql, Qt5Test, Qt5LinguistTools + Qt5DBus on Linux platform only + optionally (although required for using libquentier along with Quentier app) either Qt5WebKit and Qt5WebKitWidgets or Qt5WebEngine (and Qt5WebEngineCore for Qt &gt;= 5.6), Qt5WebEngineWidgets, Qt5WebSockets and Qt5WebChannel</li>
<li><a href="http://www.xmlsoft.org">libxml2</a> - for validation of Evernote&rsquo;s ENML note formatting against the DTD</li>
<li><a href="https://www.openssl.org">OpenSSL</a> - for encryption and decryption of note fragments as well as for Qt&rsquo;s usage of secure networking. Note that ssl/crypto libraries built into OS X / macOS by Apple don&rsquo;t contain the required encryption/decryption API and are therefore not suitable for building libquentier - you would encounter build errors if you try to use those built-in libraries. OpenSSL from <a href="https://brew.sh">Homebrew</a> or <a href="https://www.macports.org">Macports</a> would be suitable</li>
<li><a href="http://www.boost.org">Boost</a> - some header-only libraries are used, mostly <a href="http://www.boost.org/doc/libs/1_66_0/libs/multi_index/doc/index.html">multi index container</a> and <a href="http://www.boost.org/doc/libs/1_66_0/libs/bimap/doc/html/index.html">bimap</a></li>
<li><a href="https://hunspell.github.io">libhunspell</a> - for spell checking within the note editor</li>
<li><a href="https://github.com/frankosterfeld/qtkeychain">QtKeychain</a> - for reliable storage of various Evernote service&rsquo;s tokens which shouldn&rsquo;t be stored in clear text</li>
<li><a href="https://github.com/d1vanov/QEverCloud">QEverCloud</a> - for low level communication with Evernote service</li>
<li>libtidy5 from <a href="https://github.com/htacg/tidy-html5">tidy-html5</a> - for assistance in the conversion between HTML and ENML representations of notes. Note that the old libtidy 0.99 still shipped with many Linux distros won&rsquo;t be suitable!</li>
<li>For Qt4 builds only: <a href="https://github.com/d1vanov/qt4-mimetypes">qt4-mimetypes</a> - backport of Qt5&rsquo;s mime types handling to Qt4</li>
<li>Optionally: <a href="https://www.stack.nl/~dimitri/doxygen">Doxygen</a> (for automatic generation of documentation)</li>
</ul>

<p>In addition to this, libxml2 might depend on <a href="https://www.gnu.org/software/libiconv">libiconv</a> and <a href="https://zlib.net">zlib</a>.</p>

<p>On Linux and Mac at least several of these dependencies can be installed via package managers. On Windows there are several package managers as well, however, they weren&rsquo;t evaluated for being useful for installing Quentier&rsquo;s dependencies. Instead, some Quentier&rsquo;s dependencies for Windows can be downloaded from the Internet and others can be built and installed manually. Some of Quentier&rsquo;s dependencies require a couple of minor patches to support proper building on Windows.</p>

<p>Instead of (or in addition to) reading this tutorial you can look at Quentier&rsquo;s <a href="https://github.com/d1vanov/quentier/blob/master/.travis.yml">Travis CI</a> configuration file which installs and builds the necessary dependencies on each Linux and Mac CI build and at <a href="https://github.com/d1vanov/quentier-dependencies-windows/blob/master/appveyor.yml">AppVeyor</a> configuration of a <a href="https://github.com/d1vanov/quentier-dependencies-windows">separate repository</a> set up for the sole purpose of building Quentier&rsquo;s dependencies on Windows and uploading them to the <a href="https://github.com/d1vanov/quentier-dependencies-windows/releases">continuous release</a> from where they can be downloaded.</p>

<h3 id="linux">Linux</h3>

<p>It&rsquo;s hard to write the detailed guide for every possible Linux distribution as there are so many of these so this section will use Ubuntu and apt-get for the sake of example. For other distributions simply use the distribution&rsquo;s native or your preferred package manager and correct the package names accordingly.</p>

<p>First need to make sure the basic development tools are installed:</p>

<pre><code>sudo apt-get install build-essential cmake git doxygen
</code></pre>

<p>Then let&rsquo;s install Qt. Since libquentier and Quentier support building with both Qt4 and Qt5, you can install either version you like more. Here&rsquo;s the command to install Qt4 libraries:</p>

<pre><code>sudo apt-get install libqt4-dev libqt4-dev-bin libqt4-network libqt4-xml libqt4-xmlpatterns libqt4-sql libqt4-sql-sqlite libqt4-test libqt4-dbus libqt4-webkit
</code></pre>

<p>For Qt 5 the equivalent would be the following:</p>

<pre><code>sudo apt-get install qtbase5-dev qttools5-dev libqt5webkit5-dev
</code></pre>

<p>Notice one important detail which is specific to Debian, Ubuntu and all distributions derived from them (with the exception of KDE Neon and possibly some others): the official distro&rsquo;s repositories would probably not contain <code>QtWebEngine</code> which is one of two potential backends of note editor within libquentier. So in these distributions you can only build libquentier with <code>QtWebKit</code> note editor backend <em>unless</em> you use Qt built manually or installed from somewhere else than the distro&rsquo;s official repository. Such unofficial Qt repositories exist, they contain <code>QtWebEngine</code> and you can perfectly use it to build libquentier and Quentier. In fact, Quentier <a href="https://github.com/d1vanov/quentier/blob/master/.travis.yml">uses</a> one unofficial Qt version on Travis CI for packaging into <a href="https://appimage.org">AppImage</a>. <a href="https://launchpad.net/~beineri">Stephan Binner</a> does a great job of setting up launchpad repositories with various Qt versions for different versions of Ubuntu. Feel free to use them. However, bear in mind that if you use unofficial Qt, you&rsquo;d need to build <a href="https://github.com/frankosterfeld/qtkeychain">QtKeychain</a> with that Qt version instead of installing it from the official repository. It&rsquo;s not hard to do and will be explained below.</p>

<p>If you use the distro&rsquo;s native Qt4 version, that&rsquo;s how you install QtKeychain on Ubuntu:</p>

<pre><code>sudo apt-get install qtkeychain-dev
</code></pre>

<p>If you use the distro&rsquo;s native Qt5 version, you can install Qt5Keychain as follows on Ubuntu:</p>

<pre><code>sudo apt-get install qt5keychain-dev
</code></pre>

<p>If you use some unofficial Qt5 version, you need to build Qt5Keychain from source. Here&rsquo;s how it can be done:</p>

<pre><code>git clone https://github.com/frankosterfeld/qtkeychain.git
cd qtkeychain
mkdir build
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
make
sudo make install
</code></pre>

<p>Now let&rsquo;s install non-Qt dependencies:</p>

<pre><code>sudo apt-get install libxml2-dev libboost-dev libboost-program-options-dev libssl-dev libhunspell-dev
</code></pre>

<p>In more recent versions of Debian/Ubuntu (since Debian 9.0 Stretch and since Ubuntu 18.04 Bionic) you can also install tidy-html5 from the official repository:</p>

<pre><code>sudo apt-get install libtidy-dev
</code></pre>

<p>If you use less recent distros, their shipped libtidy version is too old for libquentier, so you need to build the newer version by hand:</p>

<pre><code>git clone https://github.com/htacg/tidy-html5.git
cd tidy-html5
git checkout 5.6.0
mkdir build-tidy
cd build-tidy
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
make
sudo make install
</code></pre>

<p>All other dependencies are not shipped in official Debian/Ubuntu distros so these need be built manually.</p>

<p>Let&rsquo;s build Google breakpad which is optional dependency on Linux and Windows. You can skip it and build Quentier without Google breakpad but then you won&rsquo;t get minidump and backtrace if Quentier crashes and hence it would be much harder if not impossible to understand the reason of the crash.</p>

<pre><code>git clone https://chromium.googlesource.com/breakpad/breakpad
cd breakpad
git checkout chrome_64
git clone https://chromium.googlesource.com/linux-syscall-support src/third_party/lss
./configure --prefix=/usr/local
make
sudo make install
</code></pre>

<p>If you intend to build libquentier and Quentier with Qt4, you&rsquo;d need <a href="https://github.com/d1vanov/qt4-mimetypes">qt4-mimetypes</a>. Here&rsquo;s how one can build and install it:</p>

<pre><code>git clone https://github.com/d1vanov/qt4-mimetypes.git
cd qt4-mimetypes
mkdir build
cd build
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
make
sudo make install
</code></pre>

<p>Finally, the last required dependency is <a href="https://github.com/d1vanov/QEverCloud">QEverCloud</a>:</p>

<pre><code>git clone https://github.com/d1vanov/QEverCloud.git
cd QEverCloud
mkdir build
cd build
</code></pre>

<p>At this point the build of QEverCloud has several possibilities to continue:</p>

<ul>
<li>If you build it with Qt5 from the official Debian/Ubuntu repositores, you need to pass one additional option to CMake telling it to link with <code>QtWebKit</code> rather than <code>QtWebEngine</code>:
<code>
cmake .. -DUSE_QT5=1 -DUSE_QT5_WEBKIT=1 -DCMAKE_INSTALL_PREFIX=/usr/local
</code></li>
<li>If you build it with unofficial Qt5 having <code>QtWebEngine</code>, you still need to pass in the option telling CMake to search for Qt5 in favour of Qt4:
<code>
cmake .. -DUSE_QT5=1 -DCMAKE_INSTALL_PREFIX=/usr/local
</code></li>
<li>Otherwise you can just give the &ldquo;default&rdquo; CMake command:
<code>
cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local
</code></li>
</ul>

<p>The rest of the build/installation of QEverCloud is as follows:</p>

<pre><code>make
sudo make install
</code></pre>

<p>That&rsquo;s it! Now you are ready to actually build libquentier and/or Quentier. Please proceed to the actual <a href="https://github.com/d1vanov/libquentier/blob/master/INSTALL.md">build</a> <a href="https://github.com/d1vanov/quentier/blob/master/INSTALL.md">instructions</a> for each of them.</p>

<h3 id="mac">Mac</h3>

<p>The instruction for dependencies installation on Mac is quite similar to the one for Linux, only the package manager used in this tutorial would be <a href="https://brew.sh">brew</a> instead of <code>apt-get</code>. If you use <a href="https://www.macports.org">Macports</a> instead of Homebrew, that&rsquo;s fine, you just need to use <code>port</code> instead of <code>brew</code> + some packages might have different names in Macports or some packages might be missing there so you&rsquo;d need to build the corresponding dependencies from source.</p>

<p>If you don&rsquo;t have Homebrew installed and set up yet, go to its <a href="https://brew.sh">site</a> and install and configure it. After that proceed to the following:</p>

<pre><code>brew tap owncloud owncloud/owncloud
brew install git cmake qt5 boost openssl hunspell tidy-html5 qtkeychain doxygen
</code></pre>

<p>The owncloud tap is required for its qtkeychain formula.</p>

<p>Now the only thing which requires manual building from source is QEverCloud. It can be built and installed as follows:</p>

<pre><code>git clone https://github.com/d1vanov/QEverCloud.git
cd QEverCloud
mkdir build
cd build
cmake .. -DUSE_QT5=1 -DCMAKE_INSTALL_PREFIX=/usr/local
make
make install
</code></pre>

<p>That&rsquo;s it! Now you are ready to actually build libquentier and/or Quentier. Please proceed for the actual <a href="https://github.com/d1vanov/libquentier/blob/master/INSTALL.md">build</a> <a href="https://github.com/d1vanov/quentier/blob/master/INSTALL.md">instructions</a> for each of them.</p>

<h3 id="windows">Windows</h3>

<p>Building libquentier and Quentier on Windows is by far the most complex procedure among all the three supported platforms. Building all the prerequisites by hand is hard, especially given that the build procedures are very different between MSVC and MinGW toolchains. The good news is that there are <a href="https://github.com/d1vanov/quentier-dependencies-windows/releases">prebuilt binaries</a> for two MSVC versions - Visual Studio 2015 32 bit and Visual Studio 2017 64 bit - and for 32 bit MinGW 5.3.0. In that repository one can find <a href="https://github.com/d1vanov/quentier-dependencies-windows/blob/master/appveyor.yml">appveyor.yml</a> configuration file describing the build steps for three build configurations - two MSVC ones and one MinGW one.</p>

<p>If you choose to use the prebuilt binaries, the procedure is rather simple: download the binaries for the chosen build configuration and extract them all into the same folder. That folder would then contain <code>include</code>, <code>lib</code>, <code>bin</code> and a bunch of other folders. For building libquentier and Quentier you&rsquo;d need to tell CMake the location of these folders i.e. set <code>CMAKE_PREFIX_PATH</code> to the location of this folder. You would also need to set <code>PATH</code> environment variable to the location of <code>bin</code> folder, <code>INCLUDE</code> environment variable to the location of <code>include</code> folder and <code>LIB</code> environment variable to the location of <code>lib</code> folder.</p>

<p>If you choose to build Quentier dependencies yourself on Windows, good luck! Recall that you can find the exact building steps in <a href="https://github.com/d1vanov/quentier-dependencies-windows/blob/master/appveyor.yml">this appveyor.yml</a> build configuration.</p>

<p>Before getting to the exact building steps, install the necessary software on your Windows machine:</p>

<ul>
<li><a href="https://cmake.org/download">CMake</a></li>
<li><a href="https://git-scm.com/download">Git</a></li>
<li><a href="http://www.paehl.com/open_source/?download=curl_757_0_ssl.zip">curl</a></li>
<li><a href="http://www.7-zip.org">7Zip</a></li>
</ul>

<p>Also, if you intend to build things with Visual Studio, you&rsquo;d need the following additional tools:</p>

<ul>
<li><a href="https://www.activestate.com/activeperl/downloads">Active perl</a></li>
<li><a href="https://www.python.org/downloads/release/python-2714">Python 2.7</a></li>
</ul>

<p>And if you intend to build things with MinGW, you&rsquo;d need</p>

<ul>
<li><a href="http://www.msys2.org">msys64</a> in addition to msys coming with MinGW</li>
<li><a href="https://cygwin.com/install.html">cygwin</a>; it doesn&rsquo;t matter much whether 64 or 32 bits version is used, this tutorial would assume the use of 32 bit version with Cygwin installed to <code>C:\cygwin</code>; the 64 bit Cygwin would by default be installed to <code>C:\cygwin64</code>.</li>
</ul>

<p>One more thing: if you would like the installation step of Quentier to produce the installer, you&rsquo;d need another thirdparty package: <a href="https://nsis.sourceforge.io/Main_Page">NSIS</a>.</p>

<p>Ensure the location of git, CMake, curl and 7z executables (and NSIS&rsquo; makensis if you installed it) are in your <code>PATH</code> environment variable i.e. you can execute git, CMake, curl and 7z commands from the terminal. The installers of git, CMake and 7zip should set <code>PATH</code> automatically but just in case they don&rsquo;t, you can always do this by hand. In any event you&rsquo;d need to add the location of <code>curl</code> executable to your <code>PATH</code> environment variable or alternatively to put <code>curl.exe</code> into <code>C:\Windows\System32</code> folder.</p>

<p>The <code>PATH</code> environement variable can be set from the terminal as follows (assuming that you&rsquo;ve unpacked <code>curl.exe</code> to your Downloads folder):</p>

<pre><code>set PATH=C:\Users\%username%\Downloads;%PATH%
</code></pre>

<p>This would modify the <code>PATH</code> environment variable only for the current terminal session, not permanently. In order to set the environment variable permanently you can use the convenient <a href="https://www.rapidee.com/en/download">Rapid environment editor</a> app.</p>

<p>If you installed Perl and Python, <code>perl</code> and <code>python</code> should be in <code>PATH</code> as well.</p>

<p>One more thing: for Visual Studio 2015 you might need to separately install Microsoft build tools (msbuild) from <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159">this link</a>.
You also need to ensure msbuild is in your <code>PATH</code>. For Visual Studio 2015 you can add it there as follows:</p>

<pre><code>set PATH=C:\Program Files (x86)\MSBuild\14.0\Bin;%PATH%
</code></pre>

<p>And for Visual Studio 2017 as follows:</p>

<pre><code>set PATH=C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\MSBuild\15.0\Bin;%PATH%
</code></pre>

<p>Now just pick some directory where you can download stuff and step there from the terminal. For example:</p>

<pre><code>cd C:\Users\%username%
md quentier_deps
cd quentier_deps
</code></pre>

<h4 id="building-dependencies-with-visual-studio">Building dependencies with Visual Studio</h4>

<h5 id="preparing-the-environment">Preparing the environment</h5>

<p>While you can use Visual Studio IDE to build each Quentier&rsquo;s dependency, this turotial describes the command line approach instead as it is simpler in some ways.</p>

<p>The very first thing you&rsquo;d need to do for building with Visual Studio from the command prompt is to set up all the necessary environment variables. The exact instructions for this step vary depending on the used Visual Studio version. It is a very simple thing to google up but for the sake of example here are the instructions for Visual Studio 2015: open the command prompt (i.e. <code>cmd.exe</code>) and type there the following:</p>

<pre><code>C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat
</code></pre>

<p>This would set several environment variables required to run Visual Studio&rsquo;s compiler, linker and other build tools. This command would set up the environment for <code>x86</code> i.e. 32 bit builds. If you want to build for 64 bit platform, you need to add one extra argument to the above command:</p>

<pre><code>C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat amd64
</code></pre>

<p>For the sake of another example and to illustrate why the exact instructions vary depending on the used Visual Studio version, here&rsquo;s the command which needs to be run when using Visual Studio 2017 for 64 bit builds:</p>

<pre><code>C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvars64.bat
</code></pre>

<p>Now you are ready to start downloading and building the dependencies!</p>

<h5 id="building-boost-program-options-library">Building boost program options library</h5>

<p>Let&rsquo;s get started from <a href="http://www.boost.org">Boost</a> C++ libraries. For libquentier and Quentier only the header-only parts + program options library are required. You can just download prebuilt boost binaries corresponding to your Visual Studio version from <a href="https://boost.teeks99.com">here</a> but if for some reason you want to build the program options library yourself, proceed as follows:</p>

<pre><code>curl -fsSL https://dl.bintray.com/boostorg/release/1.65.0/source/boost_1_65_0.7z -o boost_1_65_0.7z
7z x boost_1_65_0.7z
bootstrap.bat
.\b2 --build-dir=%cd%\build --with-program_options --toolset=msvc-14.0 link=shared address-model=32 runtime-link=shared variant=release,debug --build-type=complete stage
</code></pre>

<p>The <code>toolset</code> option specifies which version of Visual Studio would be used; <code>msvc-14.0</code> corresponds to Visual Studio 2015. Other options include:</p>

<ul>
<li><code>msvc-14.1</code> for Visual Studio 2017</li>
<li><code>msvc-12.0</code> for Visual Studio 2013</li>
<li><code>msvc-11.0</code> for Visual Studio 2012</li>
<li><code>msvc-10.0</code> for Visual Studio 2010</li>
</ul>

<p>I omit the rest of the list as older Visual Studio versions most likely won&rsquo;t be able to build libquentier and Quentier so you shouldn&rsquo;t use them anyway.</p>

<p>Notice the <code>address-model</code> parameter; it should be either of two values: <code>32</code> for 32 bit build or <code>64</code> for 64 bit build.</p>

<p>You can find more information about boost&rsquo;s build system <a href="http://www.boost.org/build/doc/html/index.html">here</a>.</p>

<p>After the build finishes, you&rsquo;d have built program options library within <code>lib</code> directory. For each version of the library (debug and release) there would be two files: <code>.lib</code> and <code>.dll</code> ones. When building Quentier, you might need to specify <code>BOOST_LIBRARYDIR</code> parameter pointing to the <code>lib</code> directory for CMake to find the library.</p>

<p>Another important note: boost 1.65.0 is used in this example for a reason: at the time of this writing more recent version of Boost exists: 1.66.0. Unfortunately, in this version the naming of boost library files has changed but CMake was not ready for that change. As a result, at the time of this writing the latest released CMake (3.10.1) <a href="https://gitlab.kitware.com/cmake/cmake/issues/17575">can&rsquo;t find</a> boost libraries for version 1.66.0.</p>

<h5 id="building-openssl">Building OpenSSL</h5>

<p><a href="https://www.openssl.org">OpenSSL</a> library is used by libquentier for its encryption algorithms and by Qt for secure networking. OpenSSL&rsquo;s building procedure on Windows is quite complex and seems to heavily depend on the version of OpenSSL used for building. You might want to skip the building of OpenSSL and instead just download the prebuilt version, for example, from <a href="https://slproweb.com/products/Win32OpenSSL.html">here</a>. However, note the downloaded OpenSSL might depend on another version of Visual C++ runtime than the version you intend to use for libquentier and/or Quentier. It might be a non-issue if you are building libquentier and Quentier for the purposes of develoment/testing/tinkering. But it would be an issue if you&rsquo;re building Quentier for creating the installer and further distribution of it: the installer currently only attempts to download the version of Visual C++ runtime corresponding to the Visual Studio used to build Quentier but not other versions of the runtime.</p>

<p>Important note about OpenSSL version to use: there are currently two major different versions out there: 1.0 and 1.1. Qt has only become able to work with OpenSSL 1.1 in <a href="https://wiki.qt.io/New_Features_in_Qt_5.10">5.10 release</a>, so it&rsquo;s better to use OpenSSL 1.0 version for now:</p>

<pre><code>git clone https://github.com/openssl/openssl.git
cd openssl
git checkout OpenSSL_1_0_2r
</code></pre>

<p><code>OpenSSL_1_0_2r</code> is the name of the tag which is the latest in OpenSSL 1.0 series at the time of this writing. Look at <a href="https://github.com/openssl/openssl/releases">the official OpenSSL repository&rsquo;s releases</a> to find out whether there is more recent 1.0 version available. If it&rsquo;s available, use the latest version as it might include vital security fixes.</p>

<p>Now let&rsquo;s get to the actual building procedure. It is somewhat different for 32 bit and 64 bit builds so the steps for the two variants would be displayed separately. First, the version for 32 bit build:</p>

<pre><code>perl Configure VC-WIN32 no-asm --prefix=%cd%\installdir
ms\do_ms
nmake -f ms\ntdll.mak
nmake -f ms\ntdll.mak test
nmake -f ms\ntdll.mak install
</code></pre>

<p>That was the release build of OpenSSL. All the built stuff would be installed into the installdir folder within the folder with OpenSSL sources. If you intend to build libquentier and Quentier in &ldquo;Debug&rdquo; or &ldquo;Release with debug info&rdquo; configurations (which is likely if you intend to hack on libquentier and/or Quentier) you&rsquo;d also need to build the debug OpenSSL version - for OpenSSL it is important whether the build is debug or release one due to some quite special handling of exported symbols in different versions. In short, trying to link the debug application with release version of OpenSSL might fail, hence it&rsquo;s better to have debug version as well as release one. Here&rsquo;s how the debug version can be built for 32 bit build:</p>

<pre><code>perl Configure debug-VC-WIN32 no-asm --prefix=%cd%\installdir-dbg
ms\do_ms
nmake -f ms\ntdll
nmake -f ms\ntdll.mak test
nmake -f ms\ntdll.mak install
</code></pre>

<p>Quite similar to the release build, the only difference is the configuration: <code>debug-VC-WIN32</code> instead of just <code>VC-WIN32</code> + another installation dir to prevent intermixing the two versions together.
Now it&rsquo;s better to put the debug libraries near the release ones only you&rsquo;d need to adjust their names to make it easier for CMake to find both debug and release versions:</p>

<pre><code>copy installdir-dbg\lib\libeay32.lib installdir\lib\libeay32d.lib
copy installdir-dbg\lib\ssleay32.lib installdir\lib\ssleay32d.lib
</code></pre>

<p>The 64 bit build instructions are a little different:</p>

<pre><code>perl Configure VC-WIN64A no-asm --prefix=%cd%\installdir
ms\do_win64a
nmake -f ms\ntdll.mak
cd out32dll
..\ms\test
cd ..
nmake -f ms\ntdll.mak install
</code></pre>

<p>and for debug build:</p>

<pre><code>perl Configure debug-VC-WIN64A no-asm --prefix=%cd%\installdir-dbg
ms\do_win64a
nmake -f ms\ntdll.mak
cd out32dll
..\ms\test
cd ..
nmake -f ms\ntdll.mak install
</code></pre>

<p>The same advice for holding debug libraries near the release ones holds for 64 bit as well.</p>

<h5 id="building-libiconv">Building libiconv</h5>

<p>Building libiconv 1.15 with Visual Studio is relatively easy thanks to the efforts of GitHub user <a href="https://github.com/kiyolee">kiyolee</a> who created several repositories for popular originally Unix libraries with build system set up for straightforward building with Visual Studio on Windows. The procedure is as follows:</p>

<pre><code>git clone https://github.com/kiyolee/libiconv-win-build.git
cd libiconv-win-build
</code></pre>

<p>Now need to step into the directory containing the set up build files for the version of Visual Studio you use. There are several options to choose from:</p>

<ul>
<li>build-VS2008</li>
<li>build-VS2010</li>
<li>build-VS2013-MT</li>
<li>build-VS2013</li>
<li>build-VS2015-MT</li>
<li>build-VS2015</li>
<li>build-VS2017-MT</li>
<li>build-VS2017</li>
</ul>

<p>The <code>-MT</code> switch means static linkage to multithreaded Visual C++ runtime. If you plan to distribute the built libquentier and Quentier, be aware that static linking with proprietary runtime library is generally not compatible with LGPL and GPL licenses so it&rsquo;s better to choose some non <code>-MT</code> option.</p>

<p>As this example tutorial uses Visual Studio 2015, picking the corresponding folder:</p>

<pre><code>cd build-VS2015
msbuild libiconv.sln /p:Configuration=&quot;Release&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>The &ldquo;Platform&rdquo; option specifies whether you build 32 bit or 64 bit version of the library; <code>Win32</code> means 32 bit version, <code>x64</code> means 64 bit one.
After the build the library files would be located within &ldquo;Release&rdquo; folder for 32 bit build and within &ldquo;x64\Release&rdquo; folder for 64 bit build:</p>

<ul>
<li>libiconv.lib</li>
<li>libiconv.dll</li>
</ul>

<p>The recommended approach is to copy or move these files somewhere where it&rsquo;d be easy for CMake to find them. For example, within the cloned libiconv-win-build folder you could create some <code>installdir</code> with <code>bin</code> and <code>lib</code> folders inside it. Then move libiconv.dll to <code>bin</code> folder and move libiconv.lib to <code>lib</code> folder. Than you could either specify the path to <code>installdir</code> within <code>CMAKE_PREFIX_PATH</code> or, if you don&rsquo;t plan to build libquentier and/or Quentier with different compilers, you could assign the environment variables making it unnecessary to specify anything during CMake step:</p>

<pre><code>set INCLUDE=%cd%\..\include;%INCLUDE%
set LIB=%cd%\installdir\lib;%LIB%
set PATH=%cd%\installdir\bin;%PATH%
</code></pre>

<h5 id="building-zlib">Building zlib</h5>

<p>Building zlib 1.2.11 with Visual Studio is straightforward thanks again to the efforts of GitHub user <a href="https://github.com/kiyolee">kiyolee</a>:</p>

<pre><code>git clone https://github.com/kiyolee/zlib-win-build.git
cd zlib-win-build
cd build-VS2015
msbuild zlib.sln /p:Configuration=&quot;Release&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>As with libiconv, the resulting binaries would be in &ldquo;Release&rdquo; folder for 32 bit build and in &ldquo;x64\Release&rdquo; folder for 64 bit build. The recommended approach is to put the built <code>.lib</code> and <code>.dll</code> files into relevant folders, as with libiconv (see above). The environment variables making it simple for CMake to locate the libraries are as follows:</p>

<pre><code>set INCLUDE=%cd%\..;%INCLUDE%
set LIB=%cd%\installdir\lib;%LIB%
set PATH=%cd%\installdir\bin;%PATH%
</code></pre>

<h5 id="building-libxml2">Building libxml2</h5>

<p>And once again huge thanks goes to GitHub user <a href="https://github.com/kiyolee">kiyolee</a> for making it really simple to build libxml2 on Windows:</p>

<pre><code>git clone https://github.com/kiyolee/libxml2-win-build.git
cd libxml2-win-build
cd build-VS2015
msbuild libxml2.sln /p:Configuration=&quot;Release&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>As with libiconv and zlib, the resulting binaries would be in &ldquo;Release&rdquo; folder for 32 bit build and in &ldquo;x64\Release&rdquo; folder for 64 bit build. The recommended approach is to put the built <code>.lib</code> and <code>.dll</code> files into relevant folders, as with libiconv (see above). The environment variables making it simple for CMake to locate the libraries are as follows:</p>

<pre><code>set INCLUDE=%cd%\..\include;%INCLUDE%
set LIB=%cd%\installdir\lib;%LIB%
set PATH=%cd%\installdir\bin;%PATH%
</code></pre>

<h5 id="building-libhunspell">Building libhunspell</h5>

<pre><code>git clone https://github.com/hunspell/hunspell.git
cd hunspell
git checkout v1.7.0
msbuild %cd%\msvc\Hunspell.sln /p:Configuration=&quot;Release_dll&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>The 64 bit &ldquo;Platform&rdquo; would be &ldquo;x64&rdquo;, as expected. The location of built binaries is slightly different:</p>

<ul>
<li>msvc\Release_dll\libhunspell\libhunspell.lib</li>
<li>msvc\Release_dll\libhunspell\libhunspell.dll</li>
</ul>

<p>It is for 32 bit build, for 64 bit build these would be found in</p>

<ul>
<li>msvc\x64\Release_dll\libhunspell.lib</li>
<li>msvc\x64\Release_dll\libhunspell.dll</li>
</ul>

<p>As with libiconv, zlib and libxml2, it is recommended to put the built files into relevant folders and set <code>INCLUDE</code>, <code>LIB</code> and <code>PATH</code> environment variables.</p>

<h5 id="building-tidy-html5">Building tidy-html5</h5>

<p>Building tidy-html5 is straightforward thanks to the project&rsquo;s use of CMake build system:</p>

<pre><code>git clone https://github.com/htacg/tidy-html5.git
cd tidy-html5
git checkout 5.6.0
md build-tidy
cd build-tidy
cmake .. -G &quot;NMake Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIB=ON -DCMAKE_INSTALL_PREFIX=&quot;%cd%\installdir&quot;
cmake --build . --target all
cmake --build . --target install
</code></pre>

<p>And that&rsquo;s all. The resulting binaries as well as development headers would be located in build-tidy/installdir folder. You&rsquo;d need to add it to <code>CMAKE_PREFIX_PATH</code> when building libquentier and/or Quentier. Or alternatively you can add installdir/bin to <code>PATH</code>, installdir/lib to <code>LIB</code> and installdir/include to <code>INCLUDE</code> environment variables.</p>

<h5 id="building-qtkeychain">Building qtkeychain</h5>

<p>QtKeychain library has some peculiarities on Windows so here are the detailed build instructions:</p>

<pre><code>git clone https://github.com/frankosterfeld/qtkeychain.git
cd qtkeychain
git checkout v0.9.1
</code></pre>

<p>By default QtKeychain on Windows 7 and higher uses <a href="https://www.digitalcitizen.life/credential-manager-where-windows-stores-passwords-other-login-details">Credential Store</a>. However, I encountered some problems getting it to work with libquentier and hence decided to use another option: keeping the data within <a href="https://doc.qt.io/qt-5/qsettings.html">QSettings</a> but encrypted using WinAPI function <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa380261%28v=vs.85%29.aspx">CryptProtectData</a> with the user&rsquo;s logon credentials. In addition, in this mode the built Quentier app might even work on Windows older than 7 i.e. XP.</p>

<p>Here are the steps required to build QtKeychain:</p>

<pre><code>md build
cd build
cmake .. -G &quot;NMake Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DUSE_CREDENTIAL_STORE=OFF -DCMAKE_INSTALL_PREFIX=&quot;%cd%\installdir&quot;
</code></pre>

<p>If CMake complains about not finding Qt, add `-DCMAKE_PREFIX_PATH=&rdquo;<path to Qt installation>&rdquo; to the above command.</p>

<pre><code>cmake --build . --target all
cmake --build . --target install
</code></pre>

<p>That&rsquo;s it, after this step the necessary binaries as well as development headers would be within build/installdir folder. The recipe for using them for building libquentier and/or Quentier with either <code>CMAKE_PREFIX_PATH</code> or <code>PATH</code>/<code>LIB</code>/<code>INCLUDE</code> is the same as above.</p>

<h5 id="building-google-breakpad">Building Google breakpad</h5>

<p>Building Google breakpad on Windows is a very painful experience because the process is not really well documented and, furthermore, building the project on Windows is maintained surprisingly poorly by Google. But don&rsquo;t lose hope, it is still possible to build this thing and here are the instructions:</p>

<pre><code>git clone https://chromium.googlesource.com/breakpad/breakpad
cd breakpad
git checkout chrome_64
cd src
git clone https://github.com/google/googletest.git testing
cd ..\..
git clone https://chromium.googlesource.com/external/gyp
cd gyp
python setup.py install
cd ..\breakpad
md installdir
md installdir\include\breakpad\client\windows
md installdir\include\breakpad\common\windows
md installdir\lib
md installdir\bin
xcopy src installdir\include\breakpad /e
</code></pre>

<p>The last line from the above copies almost entire sources of breakpad into the installation prefix&rsquo;s include folder. That might be overkill but hand picking the headers which really need to be present there is too much trouble so this simple hack works.</p>

<p>At this point you need to patch the gyp project file to make breakpad buildable on Windows. You can either do it by hand using any text editor or using <code>sed</code> from <code>msys64</code>: within &ldquo;breakpad/src/build&rdquo; folder there&rsquo;s a file called <code>common.gypi</code>. Inside this file you need to replace all occurrences of <code>'WarnAsError': 'true'</code> with <code>'WarnAsError': 'false'</code>. This setting controls whether the compiler would treat warnings as build errors or not. Some warnings do exist when building on Windows so in the default configuration the build can&rsquo;t succeed. Here&rsquo;s how this setting can be changed with the help of sed editor:</p>

<pre><code>C:\msys64\usr\bin\bash -lc &quot;cd /c/dev/breakpad/src/build &amp;&amp; sed -i -e \&quot;s/'WarnAsError': 'true'/'WarnAsError': 'false'/g\&quot; common.gypi&quot;
</code></pre>

<p>Replace the path to breakpad dir with your actual one in the above command.
Now can proceed building the breakpad. Will start from the client libraries and will do two builds, in release and debug configurations:</p>

<pre><code>..\gyp\gyp.bat src\client\windows\breakpad_client.gyp --no-circular-check -Dwin_release_RuntimeLibrary=2 -Dwin_debug_RuntimeLibrary=3
cd src\client\windows
msbuild breakpad_client.sln /p:Configuration=&quot;Release&quot; /p:Platform=&quot;Win32&quot;
msbuild breakpad_client.sln /p:Configuration=&quot;Debug&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>For 64 bit build set the &ldquo;Platform&rdquo; parameter to &ldquo;x64&rdquo;. The built release binaries can be found within Release/lib folder and debug ones within Debug/lib one. Copy them to the installation dir while adding the <code>\_d</code> suffix for debug libraries:</p>

<pre><code>copy Release\lib\common.lib ..\..\..\installdir\lib
copy Release\lib\crash_generation_client.lib ..\..\..\installdir\lib
copy Release\lib\crash_generation_server.lib ..\..\..\installdir\lib
copy Release\lib\exception_handler.lib ..\..\..\installdir\lib
copy Debug\lib\common.lib ..\..\..\installdir\lib\common_d.lib
copy Debug\lib\crash_generation_client.lib ..\..\..\installdir\lib\crash_generation_client_d.lib
copy Debug\lib\crash_generation_server.lib ..\..\..\installdir\lib\crash_generation_server_d.lib
copy Debug\lib\exception_handler.lib ..\..\..\installdir\lib\exception_handler_d.lib
</code></pre>

<p>Now need to build <code>dump_syms</code> utility which would then be used during the build of Quentier for the extraction of symbols from Quentier executable and libquentier library - these symbols would then be used to produce stack traces during crash handling. The end users would then be able to provide the stack traces while reporting crashes - these can be used as minimal hints to the reason of the crash. Without crash handling every single crash is like a shot in the dark - you can&rsquo;t say who did it or why.</p>

<pre><code>cd ..\..\..
..\gyp\gyp.bat src\tools\windows\tools_windows.gyp --no-circular-check -Dwin_release_RuntimeLibrary=2 -Dwin_debug_RuntimeLibrary=3
cd src\tools\windows
msbuild tools_windows.sln /p:Configuration=&quot;Release&quot; /p:Platform=&quot;Win32&quot;
</code></pre>

<p>After it&rsquo;s built copy it to the installation prefix&rsquo;s bin directory:</p>

<pre><code>copy Release\dump_syms.exe ..\..\..\installdir\bin
</code></pre>

<p>The final touch: need one other executable, <code>minidump_stackwalk</code>. It is the executable which parses the minidump produced by the crashing app using the symbols created by <code>dump_syms</code>. It seems Google has never planned for this executable to be used - or even built - on Windows because currently the only way to build this tool on Windows is using Cygwin (thus depending on its dlls). Thankfully, guys from Mozilla have already done that so this tool can just be downloaded from Mozilla servers:</p>

<pre><code>curl -fsSL http://hg.mozilla.org/build/tools/raw-file/755e58ebc9d4/breakpad/win32/minidump_stackwalk.exe -o minidump_stackwalk.exe
curl -fsSL http://hg.mozilla.org/build/tools/raw-file/755e58ebc9d4/breakpad/win32/cygwin1.dll -o cygwin1.dll
curl -fsSL http://hg.mozilla.org/build/tools/raw-file/755e58ebc9d4/breakpad/win32/cygstdc++-6.dll -o cygstdc++-6.dll
curl -fsSL http://hg.mozilla.org/build/tools/raw-file/755e58ebc9d4/breakpad/win32/cyggcc_s-1.dll -o cyggcc_s-1.dll
</code></pre>

<p>If you feel inclined, in <a href="https://groups.google.com/forum/#!topic/google-breakpad-discuss/B4xza0jGdlY">this thread</a> some guy describes what to change in breakpad sources to make <code>minidump_stackwalk</code> utility buildable on Windows with Visual C++. You can follow this description to try and build <code>minidump_stackwalk</code> on Windows with Visual C++.</p>

<p>That was the last dependency so the guide for building Quentier and/or libquentier dependencies on Windows using Visual Studio is finished now!</p>

<h4 id="building-dependencies-with-mingw">Building dependencies with MinGW</h4>

<p>Building the dependencies of Quentier and/or libquentier with MinGW on Windows is a suffiicently different experience from building with Visual C++. At some points it&rsquo;s simpler but at other points it&rsquo;s harder.</p>

<p>This tutorial would assume you build stuff with the <a href="http://mingw.org">official MinGW</a> version, not <a href="http://mingw-w64.org">mingw-w64</a>; the latter might work too but it was not tested i.e. currently MinGW build of libquentier and Quentier has only been tested in 32 bit mode.</p>

<p>Ensure MinGW&rsquo;s compilers and tools are in your <code>PATH</code> environment variable, by doing this:</p>

<pre><code>set PATH=C:\MinGW\bin;%PATH%
</code></pre>

<h5 id="building-boost-program-options-library-1">Building boost program options library</h5>

<p>Let&rsquo;s get started from <a href="http://www.boost.org">Boost</a> C++ libraries. For libquentier and Quentier only the header-only parts + program options library is required. It doesn&rsquo;t seem like prebuilt MinGW versions of boost are available somewhere on the Internet so need to build them from source:</p>

<pre><code>curl -fsSL https://dl.bintray.com/boostorg/release/1.65.0/source/boost_1_65_0.7z -o boost_1_65_0.7z
7z x boost_1_65_0.7z
bootstrap.bat gcc
.\b2 --build-dir=%cd%\build --with-program_options --toolset=gcc link=shared address-model=32 runtime-link=shared variant=release,debug --build-type=complete stage
</code></pre>

<p>You can find more information about boost&rsquo;s build system <a href="http://www.boost.org/build/doc/html/index.html">here</a>.</p>

<p>After the build finishes, you&rsquo;d have built program options library within <code>lib</code> directory. For each version of the library there would be two files: <code>.lib</code> and <code>.dll</code> ones. When building Quentier, you might need to specify <code>BOOST_LIBRARYDIR</code> parameter pointing to the <code>lib</code> directory for CMake to find the library.</p>

<h5 id="building-openssl-1">Building OpenSSL</h5>

<p><a href="https://www.openssl.org">OpenSSL</a> library is used by libquentier for its encryption algorithms and by Qt itself for secure networking. OpenSSL&rsquo;s building procedure on Windows is quite complex and seems to heavily depend on the version of OpenSSL used for building. You might want to skip the building of OpenSSL and instead just download the prebuilt version, for example, from <a href="https://slproweb.com/products/Win32OpenSSL.html">here</a>. The versions at the link were built with Visual C++ but thanks to the lack of <a href="https://en.wikipedia.org/wiki/Name_mangling">name mangling</a> for code written in C programming language, the OpenSSL libraries built by MinGW and Visual C++ can be used interchangeably. However, note that it is the exception rather than the rule - in general libraries/executables built by different compilers cannot be used together. Also note that the downloaded OpenSSL would depend on some version of Visual C++ runtime. It might be a non-issue if you are building libquentier and Quentier for the purposes of develoment/testing/tinkering. But it would be an issue if you&rsquo;re building Quentier for creating the installer and distributing it: for MinGW builds the installer currently doesn&rsquo;t offer the option to download any version of Visual C++ runtime.</p>

<p>Important note about OpenSSL version to use: there are currently two major different versions out there: 1.0 and 1.1. Qt has only become able to work with OpenSSL 1.1 in <a href="https://wiki.qt.io/New_Features_in_Qt_5.10">5.10 release</a>, so it&rsquo;s better to use OpenSSL 1.0 version for now:</p>

<pre><code>git clone https://github.com/openssl/openssl.git
cd openssl
git checkout OpenSSL_1_0_2r
</code></pre>

<p><code>OpenSSL_1_0_2r</code> is the name of the tag which is the latest in OpenSSL 1.0 series at the time of this writing. Look at the official OpenSSL repository&rsquo;s <a href="https://github.com/openssl/openssl/releases">releases</a> to find out whether there is more recent 1.0 version available. If it&rsquo;s available, use the latest version as it might include vital security fixes.</p>

<p>Here&rsquo;s how you can build OpenSSL with MinGW in a single command:</p>

<pre><code>C:\MinGW\msys\1.0\bin\bash -lc &quot;cd /c/dev/openssl &amp;&amp; ./Configure shared mingw --prefix=/c/dev/openssl/installdir &amp;&amp; make depend &amp;&amp; make &amp;&amp; make test &amp;&amp; make install&quot;
</code></pre>

<p>Replace <code>/c/dev/openssl</code> with the actual directory into which you cloned OpenSSL sources. The resulting binaries as well as development headers would be in <code>installdir</code> folder after this command.</p>

<h5 id="building-libiconv-1">Building libiconv</h5>

<pre><code>md libiconv-win-build
cd libiconv-win-build
curl -fsSL https://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.15.tar.gz -o libiconv-1.15.tar.gz
7z x libiconv-1.15.tar.gz
7z x libiconv-1.15.tar
del libiconv-1.15.tar
del libiconv-1.15.tar.gz
cd libiconv-1.15
C:\cygwin\bin\bash -lc &quot;cd /cygdrive/c/dev/libiconv-win-build/libiconv-1.15 &amp;&amp; export PATH=/usr/local/mingw32/bin:$PATH &amp;&amp; ./configure --host=i686-w64-mingw32 --prefix=$(pwd)/installdir CC=i686-w64-mingw32-gcc CPPFLAGS='-I/usr/local/mingw32/include -Wall' LDFLAGS='-L/usr/local/mingw32/lib' &amp;&amp; make &amp;&amp; make check &amp;&amp; make install&quot;
</code></pre>

<p>Replace <code>/cygdrive/c/dev/libiconv-win-build</code> in the above command with the actual Cygwin path to the created <code>libiconv-win-build</code> directory.</p>

<h5 id="building-zlib-1">Building zlib</h5>

<pre><code>md zlib-win-build
cd zlib-win-build
curl -fsSL https://zlib.net/zlib-1.2.11.tar.gz -o zlib-1.2.11.tar.gz
7z x zlib-1.2.11.tar.gz
7z x zlib-1.2.11.tar
del zlib-1.2.11.tar
del zlib-1.2.11.tar.gz
cd zlib-1.2.11
C:\MinGW\bin\mingw32-make.exe install -f win32\Makefile.gcc INCLUDE_PATH=%cd%\installdir\include BINARY_PATH=%cd%\installdir\bin LIBRARY_PATH=%cd%\installdir\lib SHARED_MODE=1
</code></pre>

<p>The resulting binaries and development headers would be within <code>installdir</code> directory inside <code>zlib-1.2.11</code> directory.</p>

<h5 id="building-libxml2-1">Building libxml2</h5>

<pre><code>git clone https://gitlab.gnome.org/GNOME/libxml2.git
cd libxml2
git checkout v2.9.7
cd win32
</code></pre>

<p>Now need to do one trick: change the extension of the import library from <code>.lib</code> to <code>.dll.a</code> as the latter one is more appropriate for MinGW built library:</p>

<pre><code>C:\msys64\usr\bin\bash -lc &quot;cd /c/dev/libxml2/win32 &amp;&amp; sed -i -e s/\$\(XML_BASENAME\)\.lib/\$\(XML_BASENAME\).dll.a/g Makefile.mingw&quot;
</code></pre>

<p>Replace <code>/c/dev/libxml2</code> in the above command with your actual <code>libxml2</code> folder.</p>

<p>One other trick is required to ensure the development headers of libiconv and the library are seen during the build of libxml2 and nothing gets in between:</p>

<pre><code>set INCLUDEBAK=%INCLUDE%
set INCLUDE=-Ic:/dev/libiconv-win-build/libiconv-1.15/installdir/include
set LIBBAK=%LIB%
set LIB=-Lc:/dev/libiconv-win-build/libiconv-1.15/installdir/lib
</code></pre>

<p>Replace <code>c:/dev/libiconv-win-build</code> in the above commands with your actual path to <code>libiconv-win-build</code>.
Now can continue with building libxml2:</p>

<pre><code>cscript configure.js compiler=mingw prefix=%cd%\installdir debug=no http=no ftp=no
C:\MinGW\bin\mingw32-make.exe install -f Makefile.mingw
</code></pre>

<p>After the build is done, you can return back the contents of <code>INCLUDE</code> and <code>LIB</code> environment variables:</p>

<pre><code>set INCLUDE=%INCLUDEBAK%
set LIB=%LIBBAK%
</code></pre>

<p>One other detail: the build just done has created</p>

<ul>
<li>shared library - libxml2.dll</li>
<li>import library - libxml2.dll.a</li>
<li>static library - libxml2.a</li>
</ul>

<p>CMake seems to prefer static library over the shared one if both are available. If you intend to build libquentier and Quentier for the purposes of development/testing/tinkering, it doesn&rsquo;t matter much which version would be used. However, for distribution purposes it&rsquo;s better to stick with the shared library. The simple way to enforce its use is to delete the just built static library:</p>

<pre><code>del installdir\lib\libxml2.a
</code></pre>

<h5 id="building-libhunspell-1">Building libhunspell</h5>

<pre><code>git clone https://github.com/hunspell/hunspell.git
cd hunspell
git checkout v1.6.2
</code></pre>

<p>A small patch is required to get libhunspell building with MinGW. Apply it along with building and installing the library:</p>

<pre><code>C:\msys64\usr\bin\bash -lc &quot;cd /c/dev/hunspell &amp;&amp; autoreconf -i &amp;&amp; sed -i -e s/\ \|\ S_IRWXG\ \|\ S_IRWXO//g src/tools/hzip.cxx &amp;&amp; CC=C:/MinGW/bin/gcc CXX=C:/MinGW/bin/g++ ./configure --prefix=$(pwd)/installdir --host=i386-unknown-mingw32 &amp;&amp; make &amp;&amp; make check &amp;&amp; make install&quot;
</code></pre>

<p>Replace <code>/c/dev/hunspell</code> in the above command with your actual path to <code>hunspell</code> directory. The resulting binaries as well as development headers would be within <code>installdir</code> folder within <code>hunspell</code> folder.
You can read more about why the patch is required <a href="https://github.com/hunspell/hunspell/issues/463">here</a> and <a href="http://mingw.5.n7.nabble.com/S-IRWXG-S-IRWXO-undefined-when-building-gcc-4-9-2-with-mingwrt-3-20-td34227.html">here</a>.</p>

<h5 id="building-tidy-html5-1">Building tidy-html5</h5>

<p>Building tidy-html5 with MinGW is very similar to building it with MSVC thanks to the project&rsquo;s use of CMake build system:</p>

<pre><code>git clone https://github.com/htacg/tidy-html5.git
cd tidy-html5
git checkout 5.6.0
md build-tidy
cd build-tidy
</code></pre>

<p>Need to deal with one odd thing before continuing: CMake sometimes stops and complains during the generation of MinGW makefiles about the presence of <code>sh.exe</code> within <code>PATH</code> environment variable; the <code>sh.exe</code> CMake doesn&rsquo;t like is typically the one from the Git installation. To work around this problem, can temporarily remove git folder from <code>PATH</code>:</p>

<pre><code>set PATH=%PATH:C:\Program Files\Git\usr\bin;=%
</code></pre>

<p>Now can proceed:</p>

<pre><code>cmake .. -G &quot;MinGW Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIB=ON -DCMAKE_INSTALL_PREFIX=&quot;%cd%\installdir&quot;
cmake --build . --target all
cmake --build . --target install
</code></pre>

<p>The resulting binaries as well as development headers would be located in build-tidy/installdir folder.</p>

<p>Don&rsquo;t forget to return git back to <code>PATH</code>:</p>

<pre><code>set PATH=%PATH%;C:\Program Files\Git\usr\bin
</code></pre>

<h5 id="building-qtkeychain-1">Building qtkeychain</h5>

<pre><code>git clone https://github.com/frankosterfeld/qtkeychain.git
cd qtkeychain
git checkout v0.9.1
</code></pre>

<p>One patch is required for building with MinGW:</p>

<pre><code>C:\msys64\usr\bin\bash -lc &quot;cd /c/dev/qtkeychain &amp;&amp; sed -i s/SecureZeroMemory/ZeroMemory/g keychain_win.cpp&quot;
</code></pre>

<p>Note that this patch might have consequences for qtkeychain&rsquo;s security: some C++ compilers might optimize away the call to <code>ZeroMemory</code> but not the call to <code>SecureZeroMemory</code>. You might want to apply a more proper patch emulating <code>SecureZeroMemory</code> missing in MinGW, see <a href="http://www.programmingforums.org/post94456.html">this</a> to get started.</p>

<p>As with tidy-html5, need to work around CMake&rsquo;s problem with <code>sh.exe</code> within <code>PATH</code>:</p>

<pre><code>set PATH=%PATH:C:\Program Files\Git\usr\bin;=%
</code></pre>

<p>Now can proceed to building qtkeychain for MinGW:</p>

<pre><code>md build
cd build
cmake .. -G &quot;MinGW Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DUSE_CREDENTIAL_STORE=OFF -DCMAKE_INSTALL_PREFIX=&quot;%cd%\installdir&quot;
</code></pre>

<p>If CMake complains about not finding Qt, add `-DCMAKE_PREFIX_PATH=&rdquo;<path to Qt installation>&rdquo; to the above command.</p>

<pre><code>cmake --build . --target all
cmake --build . --target install
</code></pre>

<p>Now returning git back to <code>PATH</code>:</p>

<pre><code>set PATH=%PATH%;C:\Program Files\Git\usr\bin
</code></pre>

<p>That was currently the last dependency for MinGW as Google breakpad is not integrated into MinGW version of Quentier at the moment.</p>

    

    
        
	    
	    <hr/>
    	<p><a href="" id="series"></a>This is a post in the <b>Developers guide</b> series.<br/>
    	Other posts in this series:</p>
        
        
        <ul class="series">
        
            <li>Mar 15, 2018 - 
            
                <a href="https://d1vanov.github.io/quentier/blog/quentier-local-storage-overview/">Quentier local storage implementation overview </a>
            
            </li>
        
            <li>Jan 19, 2018 - 
            
                Installation of Quentier&#39;s dependencies
            
            </li>
        
            <li>Jan 07, 2018 - 
            
                <a href="https://d1vanov.github.io/quentier/blog/quentier-technical-overview/">Quentier internals overview </a>
            
            </li>
        
        </ul>
	 
	
    <div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
    
    
    if (window.location.hostname == "localhost") 
        return;
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'quentier';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the comments powered by <a href="http://disqus.com/?ref_noscript">Disqus.</a></noscript>

</div>
</div> 

</body>w
</html>
